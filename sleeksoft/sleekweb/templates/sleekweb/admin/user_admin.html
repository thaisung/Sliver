{% extends './base.html' %}
{% block title %}Quản lý Sản phẩm{% endblock %}
{% block content %}
<div class="w-full flex-col min-h-screen h-full">
    <div class="flex items-center flex-col lg:flex-row lg:justify-between border-b-[1px] border-[#0e203c] lg:max-h-[50px] px-3 py-2 font-bold">
        <span class="uppercase w-full flex justify-center lg:justify-start mb-2 lg:mb-[0px]">
            User Page
        </span>
        <div class="flex items-center gap-3">
            <form class="flex flex-col lg:flex-row gap-2 items-center h-auto">
                <select name="f" onchange="this.form.submit()" class=" w-full lg:min-w-[200px] font-medium text-sm rounded-full border-[1px] border-[#0e203c] px-4 bg-transparent" >
                    <option value="" selected>-- Region -- </option>
                    {% for i in list_Region %}
                    <option value="{{i.id}}" {% if f == i.id %}selected{% endif %}>{{i.Name}}</option>
                    {% endfor %}
                </select>
                <select name="f1" onchange="this.form.submit()" class=" w-full lg:min-w-[200px] font-medium text-sm rounded-full border-[1px] border-[#0e203c] px-4 bg-transparent" >
                    <option value="" selected>-- Nation -- </option>
                    {% for i in list_Nation %}
                    <option value="{{i.id}}" {% if f1 == i.id %}selected{% endif %}>{{i.Name}}</option>
                    {% endfor %}
                </select>
                <div  class=" relative w-full lg:min-w-[200px] flex items-center justify-center">
                    <input value="{{s}}" name="s" class="font-medium text-sm rounded-full border-[1px] border-[#0e203c] px-4" placeholder="Search"
                        style="background: transparent;" />
                    <button type="submit" class="absolute right-2">
                        <svg class="w-[25px]" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129"
                        xmlns:xlink="http://www.w3.org/1999/xlink" enable-background="new 0 0 129 129">
                        <g>
                            <path
                                d="M51.6,96.7c11,0,21-3.9,28.8-10.5l35,35c0.8,0.8,1.8,1.2,2.9,1.2s2.1-0.4,2.9-1.2c1.6-1.6,1.6-4.2,0-5.8l-35-35   c6.5-7.8,10.5-17.9,10.5-28.8c0-24.9-20.2-45.1-45.1-45.1C26.8,6.5,6.5,26.8,6.5,51.6C6.5,76.5,26.8,96.7,51.6,96.7z M51.6,14.7   c20.4,0,36.9,16.6,36.9,36.9C88.5,72,72,88.5,51.6,88.5c-20.4,0-36.9-16.6-36.9-36.9C14.7,31.3,31.3,14.7,51.6,14.7z">
                            </path>
                        </g>
                    </svg>
                    </button>
                </div>
            </form>
            <a href="{% url 'user_add_admin' %}">
                <svg class="w-[35px] h-[35px] fill-[#0e203c]" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="438.533px" height="438.533px"
                    viewBox="0 0 438.533 438.533" style="enable-background:new 0 0 438.533 438.533;"
                    xml:space="preserve">
                    <g>
                        <path d="M409.133,109.203c-19.608-33.592-46.205-60.189-79.798-79.796C295.736,9.801,259.058,0,219.273,0
                            c-39.781,0-76.47,9.801-110.063,29.407c-33.595,19.604-60.192,46.201-79.8,79.796C9.801,142.8,0,179.489,0,219.267
                            c0,39.78,9.804,76.463,29.407,110.062c19.607,33.592,46.204,60.189,79.799,79.798c33.597,19.605,70.283,29.407,110.063,29.407
                            s76.47-9.802,110.065-29.407c33.593-19.602,60.189-46.206,79.795-79.798c19.603-33.596,29.403-70.284,29.403-110.062
                            C438.533,179.485,428.732,142.795,409.133,109.203z M347.179,237.539c0,4.948-1.811,9.236-5.428,12.847
                            c-3.62,3.614-7.901,5.428-12.847,5.428h-73.091v73.084c0,4.948-1.813,9.232-5.428,12.854c-3.613,3.613-7.897,5.421-12.847,5.421
                            h-36.543c-4.948,0-9.231-1.808-12.847-5.421c-3.617-3.621-5.426-7.905-5.426-12.854v-73.084h-73.089
                            c-4.948,0-9.229-1.813-12.847-5.428c-3.616-3.61-5.424-7.898-5.424-12.847v-36.547c0-4.948,1.809-9.231,5.424-12.847
                            c3.617-3.617,7.898-5.426,12.847-5.426h73.092v-73.089c0-4.949,1.809-9.229,5.426-12.847c3.616-3.616,7.898-5.424,12.847-5.424
                            h36.547c4.948,0,9.233,1.809,12.847,5.424c3.614,3.617,5.428,7.898,5.428,12.847v73.089h73.084c4.948,0,9.232,1.809,12.847,5.426
                            c3.617,3.615,5.428,7.898,5.428,12.847V237.539z"></path>
                    </g>
                    <g>
                    </g>
                    <g>
                    </g>
                    <g>
                    </g>
                    <g>
                    </g>
                    <g>
                    </g>
                    <g>
                    </g>
                    <g>
                    </g>
                    <g>
                    </g>
                    <g>
                    </g>
                    <g>
                    </g>
                    <g>
                    </g>
                    <g>
                    </g>
                    <g>
                    </g>
                    <g>
                    </g>
                    <g>
                    </g>
                </svg>
            </a>
        </div>
        <style>
            input:focus {
                outline: none !important;
            }
        </style>
    </div>
    <div class="w-full grow p-[15px]">
        <div class="relative overflow-x-auto rounded-md overflow-hidden border-[2px] border-[#0e203c]">
            <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-stone-100 uppercase bg-[#11284A]">
                    <tr>
                        <!-- <th scope="col" class="p-4">
                            <div class="flex items-center">
                                <input id="checkbox-all-search" type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded-sm focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                <label for="checkbox-all-search" class="sr-only">checkbox</label>
                            </div>
                        </th> -->
                        <th scope="col" class="px-6 py-3">
                            Email
                        </th>
                        <th scope="col" class="px-6 py-3">
                            Create time
                        </th>
                        <th scope="col" class="px-6 py-3">
                            Active - Time
                        </th>
                        <!-- <th scope="col" class="px-6 py-3">
                            Active - Login
                        </th> -->
                        <th scope="col" class="px-6 py-3">
                            Action
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for i in list_User %}
                    {% if not i.is_superuser %}
                    <tr class="bg-white  border-t-[2px] dark:bg-gray-800 dark:border-gray-700 border-[#0e203c] hover:bg-gray-50 dark:hover:bg-gray-600 h-full">
                        <!-- <td class="w-4 p-4">
                            <div class="flex items-center">
                                <input id="checkbox-table-search-1" type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded-sm focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                <label for="checkbox-table-search-1" class="sr-only">checkbox</label>
                            </div>
                        </td> -->
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                            <div class="flex flex-col gap-1">
                                <span>{{i.username}}</span>
                                {% if i.is_superuser %}
                                    <span class="text-red-500 font-bold">ADMIN</span>
                                {% else %}
                                    <span class="text-gray-500 ">Member</span>
                                {% endif %}
                            </div>
                        </th>
                        <td class="px-6 py-4">
                            {{i.Creation_time|date:'d/m/y'}}
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex flex-col">
                                <div class="flex items-center gap-1">
                                    <svg class="{% if i.obj_user.days_left > 0 %}fill-green-500{% else %}fill-stone-400{% endif %} w-[15px]" version="1.1" id="Layer_1_1_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16" style="enable-background:new 0 0 16 16;" xml:space="preserve">
                                        <circle cx="8" cy="8" r="8"></circle>
                                        </svg>
                                    <span>{{i.obj_user.Start_time|date:'d/m/y'}} - {{i.obj_user.End_time|date:'d/m/y'}}</span>
                                </div>
                                <span class="pl-[20px]">{{i.obj_user.days_left}} days left</span>
                            </div>
                        </td>
                        <!-- <td class="px-6 py-4">
                            Active login
                        </td> -->
                        <td class="px-6 py-4">
                            <div class="flex items-center gap-2">
                                <a href="{% url 'user_edit_admin' pk=i.id %}" class="font-medium text-blue-600 dark:text-blue-500 hover:underline">Edit</a>
                                <form id="Remove" class="Remove">
                                    {% csrf_token %}
                                    <input type="hidden" name="id" value="{{i.id}}" />
                                    <input type="hidden" name="username" value="{{i.username}}" />
                                    <button type="submit" class="font-medium text-red-600 dark:text-red-500 hover:underline ms-3">Remove</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        $('.open_input_Size').on('click', function() {
            $('.input_Size').toggle(); // Bật nếu ẩn, ẩn nếu bật
        });
    });
</script>
<script>
    $(document).ready(function() {
        $('.Remove').on('submit', function(event) {
            event.preventDefault();
            // $('#loader_login').show()
            // $('#Login_Form').hide()
        
            var formData = new FormData(this);  // Tạo FormData từ form hiện tại
            if (confirm("Are you sure you want to delete your account " + formData.get("username") + " ?")) {
                $.ajax({
                url: '{% url 'user_remove_admin' %}',
                method: 'POST',
                processData: false,  // Không xử lý dữ liệu (cần thiết khi sử dụng FormData)
                contentType: false,  // Không đặt kiểu content (cần thiết khi sử dụng FormData)
                data: formData,
                success: function(response) {
                    if (response.success) {
                        // alert(response.message);
                        window.location.href = response.redirect_url;
                    } else {
                        // $('#loader_login').hide()
                        // $('#Login_Form').show()
                        alert(response.message);
                    }
                },
                error: function(response) {
                    console.log('Registration failed', response);
                }
                });
            } else {
                // Huỷ xoá
                return false;
            }
        });
        
    });
</script>
{% endblock %}